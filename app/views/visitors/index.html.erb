<p id="notice"><%= notice %></p>
<div class="content">
  <div class="page-header">
    <h1 class="visitor_title">Listing Visitors</h1>
  </div>
  <form class="pull-right form-inline">
    <div class="form-group">
      <div class="input-group input-daterange">
        <!--<input id="start_date" type="text" name="start_date" class="form-control">-->
        <%= text_field_tag :text, params[:start_date], class: 'form-control', id: 'start_date', name: 'start_date' %>
        <span class="input-group-addon">to</span>
        <!--<input id="end_date" type="text" name="end_date" class="form-control">-->
        <%= text_field_tag :text, params[:end_date], class: 'form-control', id: 'end_date', name: 'end_date' %>
      </div>
    </div>
    <button type="submit" class="btn btn-maroon">Submit</button>

  </form>
  <br><br><br>
</div>

<div id="alert_danger" class="alert alert-danger alert-dismissible" role="alert">
<strong>Invalid Date Range! </strong> Please change the date range and try submitting again.
</div>

<div id="alert_warning" class="alert alert-warning alert-dismissible" role="alert">
<strong>The date is not reached yet! </strong> Please change the date range and try submitting again.
</div>

<div style="display: table; width: 100%">
  <div class="form-group pull-left">
    <div class="dropdown">
      <button class="btn btn-default dropdown-toggle form-control" type="button" id="area-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        Choose Area
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="area-dropdown">
        <li><a href="/visitors?area=Austin">Austin</a></li>
        <li><a href="/visitors?area=College+Sation">College Station</a></li>
        <li><a href="/visitors?area=DFW">Dallas/Fort Worth</a></li>
        <li><a href="/visitors?area=Houston">Houston</a></li>
        <li><a href="/visitors?area=San+Antonio">San Antonio</a></li>
        <li><a href="/visitors?area=OtherTX">Other Cities in Texas</a></li>
        <li><a href="/visitors?area=OutTX">Out of Texas</a></li>
        <li><a href="/visitors?area=OutUS">Out of Country</a></li>
      </ul>
    </div>
    <!--<br>-->
    <!--<input class="search form-control" id="search_zipcode" placeholder="Enter Zip Code" type="text">-->
  </div>

  <div class="form-group pull-right">
    <input class="search form-control" id="search_visitor" placeholder="Search" type="text">
  </div>

</div>

<div style="margin: 0 auto; text-align:center; padding-bottom: 30px">
  <!--<table class="table table-bordered table-hover sortable results">-->
  <table id="visitors_table" class="sortable results">
    <thead>
      <tr>
        <th class="table_header">Last name</th>
        <th class="table_header">First name</th>
        <th class="table_header">Group</th>
        <th class="table_header">Visit Date</th>
        <th class="table_header">Email</th>
        <th class="table_header">Contact</th>
        <th class="table_header">Zip code</th>
        <th class="table_header">Country</th>
        <th class="table_header" colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @visitors.each do |visitor| %>
        <tr>
          <td><%= visitor.last_name %></td>
          <td><%= visitor.first_name %></td>
          <td><%= visitor.group_id %></td>
          <td><%= visitor.created_at %></td>
          <td><%= visitor.email %></td>
          <td><%= visitor.contact %></td>
          <td><%= visitor.zip_code %></td>
          <td><%= visitor.country.name %></td>
          <td><%= link_to 'Show', visitor, class: 'btn btn-info' %></td>
          <td><%= link_to 'Edit', edit_visitor_path(visitor), class: 'btn btn-warning' %></td>
          <td><%= link_to 'Destroy', visitor, class: 'btn btn-danger', method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
    $('.input-daterange input').each(function() {
        //$(this).datepicker("clearDates");
    });
    $( document ).ready(function() {
        $('#alert_danger').hide();
        $('#alert_warning').hide();

        if($('#end_date').val() == '' && $('#start_date').val()== '') {
            $('#end_date').datepicker("setDate", new Date());
            var startdate = $('#end_date').datepicker('getDate', '+1d');
            startdate.setDate(startdate.getDate() - 15);
            $('#start_date').datepicker("setDate", startdate);
        }
        else{
            $('#start_date').datepicker();
            $('#end_date').datepicker();
        }

        $(".search").keyup(function () {
            var searchTerm = $(".search").val();
            var listItem = $('.results tbody').children('tr');
            var searchSplit = searchTerm.replace(/ /g, "'):containsi('")

            $.extend($.expr[':'], {'containsi': function(elem, i, match, array){
                return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
            }
            });

            $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function(e){
                $(this).attr('visible','false');
            });

            $(".results tbody tr:containsi('" + searchSplit + "')").each(function(e){
                $(this).attr('visible','true');
            });

            var jobCount = $('.results tbody tr[visible="true"]').length;
            $('.counter').text(jobCount + ' item');

            if(jobCount == '0') {$('.no-result').show();}
            else {$('.no-result').hide();}
        });

      $('.dropdown-toggle').dropdown();

        $('#submit_btn').click(function(event) {
            if(new Date($('#start_date').val()) >= new Date($('#end_date').val())) {
                event.preventDefault();
                $('#alert_danger').show();
                $("#alert_danger").fadeTo(3000, 500).slideUp(500, function(){
                    $("#alert_danger").hide();
                });
            }
            else if(new Date($('#end_date').val()) > (new Date($.now()))){
                event.preventDefault();
                $('#alert_warning').show();
                $("#alert_warning").fadeTo(3000, 500).slideUp(500, function(){
                    $("#alert_warning").hide();
                });
            }
        });

        $('#modal_btn').click(function(){
        $.ajax({
            type: "GET",
            dataType: "html",
            url: "/zipcodes#index",
            success: function(data){
                var arr = $.map(data, function(el) { return el.zip_code });
                $( "#sign_in_zipcode" ).autocomplete({
                    source: arr,
                    delay: 0
                });
            }
        });
        });

    });
</script>
